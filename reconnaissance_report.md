# РАЗВЕДКА САЙТА АЛКОТЕКА.COM

## 1. ОБЩАЯ ИНФОРМАЦИЯ О САЙТЕ

**URL:** https://alkoteka.com
**Описание:** Сеть специализированных магазинов алкогольной продукции с ассортиментом более 5000 наименований
**Платформа:** Веб-приложение на основе SPA (Single Page Application)
**Сервер:** Nginx
**Язык контента:** Русский

---

## 2. ЗАЩИТА И БЕЗОПАСНОСТЬ

### 2.1 reCAPTCHA
- **Статус:** ✓ Включена
- **Версия:** reCAPTCHA v2 (вероятно)
- **Site Key:** `6LeRjnAqAAAAAGYbdifUMGXJBc1mv8tE5NfmcBvr`
- **Расположение:** На основном элементе `<body>`
- **Атрибуты:**
  - `data-recaptcha-enable="1"`
  - `data-recaptcha-site-key="6LeRjnAqAAAAAGYbdifUMGXJBc1mv8tE5NfmcBvr"`

### 2.2 Механизмы защиты отботов
- ✓ reCAPTCHA активна на всех страницах
- ✓ XSRF/CSRF токен используется
- ✗ Cloudflare НЕ используется (обычный Nginx)
- ✗ Rate limiting не выявлен

### 2.3 Cookies и сессия
При подключении устанавливаются следующие cookies:
```
XSRF-TOKEN: [зашифрованный JWT-подобный токен]
sid: [зашифрованный session ID]
```

**Назначение:**
- `XSRF-TOKEN`: Защита от CSRF атак
- `sid`: Идентификатор сессии (вероятно, Laravel)

---

## 3. АРХИТЕКТУРА ПРИЛОЖЕНИЯ

### 3.1 Технологический стек
- **Frontend Framework:** Вероятно Vue.js или React (не обнаружен явно, но используется SPA архитектура)
- **Build Tool:** Vite или аналогичный (по названию bundle: `index-[hash].js`)
- **Backend:** Laravel (на основе структуры cookies и XSRF-TOKEN)
- **API Structure:** RESTful (вероятно)

### 3.2 Файлы и ресурсы
```
HTML:
  - /                              (главная страница)
  - /catalog                       (каталог товаров)
  - /account/*                     (личный кабинет)
  - /blog                          (блог)
  - /cart                          (корзина)

JavaScript Assets:
  - /app/assets/index-[hash].js    (main bundle, ~1.47 MB)
  - /app/assets/index-[hash].css   (main styles)

Images & Resources:
  - /app/images/common/favicon.ico
  - /og_image.png                  (для OG tags)
```

---

## 4. СТРУКТУРА ДАННЫХ И ПАГИНАЦИЯ

### 4.1 Обнаруженные маршруты в приложении
```
Frontend Routes:
  - /                              (главная)
  - /catalog                       (каталог)
  - /account/feedback              (обратная связь)
  - /account/profile               (профиль)
  - /account/reserve               (резервирование)
  - /account/settings              (настройки)
  - /blog                          (блог)
  - /cart                          (корзина)
  - /cart/reserve                  (резервирование товара)
```

### 4.2 Система региональных данных
- **Включена:** Да (89 упоминаний "city" в коде)
- **Параметры:**
  - Region ID или название города
  - Автоматическое определение при первом входе
- **Влияние на контент:** Товары и цены зависят от выбранного города
- **Текущий регион:** Определяется клиентом или сервером

### 4.3 Пагинация
- **Тип:** Не выявлен явно (вероятно, infinite scroll или client-side pagination)
- **Параметры:** Не обнаружены в маршрутах
- **Предположение:** Данные загружаются динамически через SPA механизм

---

## 5. API ENDPOINTS

### 5.1 Обнаруженные endpoints
```
Found in JavaScript:
  - /api/info               (структура неизвестна, 404 при прямом доступе)
  - /catalog/enogram        (специальный endpoint, назначение неизвестно)
```

### 5.2 Недоступные endpoints (404)
```
Tested but not found:
  - /api/v1/products
  - /api/products
  - /api/catalog
  - /api/categories
  - /api/search
  - /graphql
  - /api/mobile/*
  - /api/app/*
  - /api/config
  - /api/init
```

### 5.3 Предположение о API структуре
Поскольку приложение - это SPA, API вероятно:
1. Обслуживается динамически (требует JavaScript выполнения)
2. Может быть защищён дополнительной авторизацией
3. Может требовать конкретных заголовков или cookies

---

## 6. МЕТОДЫ ПАРСИНГА

### 6.1 Возможные подходы

#### ✓ Рекомендуемые методы
1. **Selenium/Playwright** (Лучший вариант)
   - Выполняет JavaScript
   - Может обойти reCAPTCHA (с использованием внешних сервисов)
   - Получает полностью отрендерённую страницу

2. **Puppeteer** (Node.js)
   - Автоматизирует браузер
   - Может обойти базовые защиты
   - Требует установки Chrome/Chromium

#### ✗ Не рекомендуемые методы
1. **Простой Scrapy без JavaScript**
   - Не сможет выполнить JS-код
   - Получит только HTML оболочку
   - Не получит реальные данные товаров

2. **Requests + BeautifulSoup**
   - Не выполняет JavaScript
   - Работает только со статическим HTML
   - Столкнётся с reCAPTCHA

### 6.2 Обход reCAPTCHA
Для автоматизированного парсинга потребуется:
1. **Сервис распознавания CAPTCHA:**
   - 2Captcha.com
   - Anti-Captcha.com
   - CapSolver.com

2. **Параметры:**
   - `sitekey`: `6LeRjnAqAAAAAGYbdifUMGXJBc1mv8tE5NfmcBvr`
   - `pageurl`: `https://alkoteka.com`
   - `type`: 2 (reCAPTCHA v2)

---

## 7. РЕГИОНАЛЬНЫЕ ДАННЫЕ

### 7.1 Текущая конфигурация
- **Текущий регион при разведке:** Default (не определён явно)
- **Поддерживаемые регионы:** Вероятно, все крупные города России
- **Влияние региона:**
  - Доступные товары (может различаться)
  - Цены и акции
  - Информация о доставке

### 7.2 Выбор региона
Текущий регион Краснодар требует:
1. Найти механизм выбора города в UI
2. Проверить, сохраняется ли выбор в cookies/localStorage
3. Убедиться, что данные товаров зависят от региона

---

## 8. СТРУКТУРА ТОВАРОВ

### 8.1 Примеры категорий (из categories.json)
```json
[
  {
    "name": "Водка",
    "id": "2321",
    "route": "/catalog" с фильтром категории
  },
  {
    "name": "Коньяк",
    "id": "2322"
  },
  {
    "name": "Пиво",
    "id": "2323"
  },
  {
    "name": "Вино",
    "id": "2324"
  },
  {
    "name": "Виски",
    "id": "2325"
  }
]
```

### 8.2 Предполагаемые поля товара
На основе структуры сайта предполагаются следующие поля:
- ID товара
- Название
- Описание
- Цена
- Изображение
- Рейтинг (если есть)
- Наличие/Доступность
- Категория
- Объём/Литраж
- Крепость (для алкоголя)
- Страна производства
- Бренд

---

## 9. ПРОБЛЕМЫ И РЕКОМЕНДАЦИИ

### 9.1 Основные препятствия для парсинга
| Препятствие | Уровень | Решение |
|-----------|---------|---------|
| reCAPTCHA v2 | Средний | Внешний сервис распознавания |
| SPA архитектура | Средний | Selenium/Playwright для JS выполнения |
| XSRF токен | Низкий | Автоматически управляется сессией |
| Региональная фильтрация | Средний | Настройка региона перед парсингом |
| Динамическая загрузка | Средний | Ожидание элементов в браузере |

### 9.2 Рекомендуемая архитектура парсера
```
1. Инициализация браузера (Selenium/Playwright)
2. Навигация на сайт
3. Обход reCAPTCHA (2Captcha/Anti-Captcha)
4. Выбор региона (Краснодар)
5. Открытие каталога
6. Извлечение товаров со всех страниц
7. Сохранение данных в JSON/CSV/DB
```

### 9.3 Скорость и задержки
- **Рекомендуемое время между запросами:** 2-5 секунд
- **User-Agent:** Обновить на реальный браузер
- **Headers:** Использовать полный набор браузерных заголовков
- **Cookies:** Сохранять и переиспользовать между сессиями

---

## 10. ДОПОЛНИТЕЛЬНЫЕ ССЫЛКИ И РЕСУРСЫ

### 10.1 Найденные социальные сети
- Telegram: https://t.me/alkoteka_shop
- VK: https://vk.com/alkotekaa
- Ambassador программа: https://ambassador.alkoteka.com/

### 10.2 Аналитика
- Yandex.Metrika: ID `52701037` (используется для отслеживания)
- Google Analytics: Не обнаружена явно (возможна через GTM)

### 10.3 Монетизация
- Интеграция с Giftery (подарочные карты): https://widget.giftery.cards/

---

## 11. ЗАКЛЮЧЕНИЕ

**Допустимость парсинга:** ⚠️ **Условно допустимо** с соблюдением следующих условий:

1. ✓ Сайт не имеет явного запрета на robots.txt
2. ✓ Не использует Cloudflare (относительно просто обойти)
3. ⚠️ Имеет reCAPTCHA (требует платного обхода или браузер-автоматизации)
4. ✓ Технически возможно парсить с использованием Selenium/Playwright

**Этапы реализации:**
1. Убедиться в легитимности парсинга (проверить ToS)
2. Выбрать инструмент: Selenium (Python) или Playwright
3. Настроить обход reCAPTCHA (2Captcha API)
4. Реализовать логику навигации и извлечения данных
5. Добавить обработку ошибок и повторные попытки
6. Оптимизировать скорость и надёжность

---

**Дата разведки:** 2025-12-03
**Статус:** ✓ Завершено
